# Pkg-file-service

### x) Lue ja tiivistä:
- **[Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port](https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh)**
  - Package-file-servicen yleinen kaava on:
    - Halutun softan asennus
    - Konfigurointitiedoston muokkaus/korvaus
    - Demonin uudelleen käynnistys
  - SSH-palvelimen portin vaihto package-file-servicenä
    - Luodaan ssh-tiedosto komennolla `sudo nano /srv/salt/sshd.sls` ja lisätään softaan liittyvä sisältö (mm. asentaa openssh-serverin tarvittaessa ja käynnistää palvelun uudelleen, jos config tiedosto muuttuu)
    - Luodaan konfigurointitiedosto komennolla `sudo nano /srv/salt/sshd_config` ja lisätään halutut asetukset (esim. portin vaihto)
    - Sovelletaan tila kaikille minion-palvelimille komennolla `sudo salt '*' state.apply sshd`
    - Testataan, että kaikki toimii ajamalla komento `nc -vz tero.example.com 8888` tai `ssh -p 8888 tero@tero.example.com`

### a) Apache easy mode. Asenna Apache, korvaa sen testisivu ja varmista, että demoni käynnistyy
- Päätin hyödyntää aiemmissa tehtävissä luotua t001 palvelinta. Aloitin avaamalla komentorivin ja siirtymällä twohost-kansioon cd-komennolla. Tämän jälkeen käynnistin virtuaalikoneet `vagrant up` komennolla ja yhdistin t001 palvelimelle komennolla `vagrant ssh t001`. Ennen tehtävän aloittamista varmistin, että apache ei ollut valmiiksi asennettuna ajamalla komennon `systemctl status apache2`. Komento ei löytänyt apachea, joten siirryin asentamaan apachea käsin.

  ![Näyttökuva 2025-04-22 171226](https://github.com/user-attachments/assets/db724811-6b26-4a01-a884-683ddffee40e)

- Aloitin asennnuksen hakemalla ensin päivitykset komennolla `sudo apt-get update` ja sen jälkeen asensin apachen komennolla `sudo apt install apache2 -y`. Tämän jälkeen muokkasin index.html tiedostoa tehtävänannossa annetulla komennolla `echo "Hei"|sudo tee /var/www/html/index.html`. Varmistin, että apache oli käynnissä ajamalla uudelleen komennon `systemctl status apache2` ja testasin, että yhteys toimii komennolla `curl http://localhost`. Komento palautti oikean echo-viestin, joten kaikki vaikuttaisi toimivan oikein.

  ![Näyttökuva (265)](https://github.com/user-attachments/assets/00441e3d-9fd9-4519-ae0e-3d3885a89d2d)

- Tämän jälkeen poistin apachen komennolla `sudo apt purge apache2* -y` ja varmistin, että se oli poistettu ajamalla uudelleen komennon `systemctl status apache2`. Komento ei enää löytänyt apachea, joten siirryin automatisointiin.

  ![Näyttökuva (266)](https://github.com/user-attachments/assets/67e368db-cc3b-4e28-b01c-b511496e0169)
  
- ad

### b) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.
- 

## Lähteet:
- Karvinen 2018: https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh. Luettu 22.4.2025.
- Karvinen 2025: https://terokarvinen.com/palvelinten-hallinta/#laksyt. Luettu 22.4.2025.




